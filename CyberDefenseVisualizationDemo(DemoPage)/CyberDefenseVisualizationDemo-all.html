<!DOCTYPE html>
<!--è¯·å‹¿åœ¨æœªç»å…è®¸çš„æƒ…å†µä¸‹ä½¿ç”¨è¯¥é¡µé¢çš„ä»£ç -->
<!--è¯¥é¡µé¢ç‰ˆæƒå½’Rockaz.topçš„å¼€å‘è€…æ‰€æœ‰-->
<!--æ­¤é¡µä»£ç å·²å¼€æºè‡³GitHubï¼Œå—åˆ°å¼€æºåè®®ä¿æŠ¤-->
<!--æˆ‘ä»¬å»ºè®®ï¼Œå¦‚æœä½ éœ€è¦æ­¤é¡µä»£ç ï¼Œè¯·åˆ°GitHubé¡µä¸‹è½½ï¼Œå¹¶ä¸”åœ¨Apache-2.0è®¸å¯è¯çš„è§„åˆ™ä¸‹ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å·-->
<!--
    æœ¬é¡µGitHubä»“åº“ï¼šhttps://github.com/add-qwq/CyberDefenseVisualizationDemo
-->
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œæ”»é˜²å¯è§†åŒ–æ¼”ç¤º</title>
    <style>
        :root {
            --bg-color: #000;
            --main-text-color: #ddd;
            --header-bg: #0d0d0d;
            --ui-border: #444;
            --term-green: #00ff00;
            --term-red: #ff3333;
            --term-yellow: #ffff00;
            --term-blue: #00ffff;
            --button-bg: #1a1a1a;
            --button-border: #333;
            --button-text: #ccc;
            --grid-color: #2d2d2d;
            --tooltip-bg: rgba(30, 30, 30, 0.9);
            --tooltip-color: #fff;
            --tooltip-border: 1px solid var(--term-blue);
            --tooltip-border-color: #fff;
            --tooltip-arrow-color: #fff;
        }

        .light-mode {
            --bg-color: #fff;
            --main-text-color: #333;
            --header-bg: #f0f0f0;
            --ui-border: #ccc;
            --term-green: #00ff00d8;
            --term-red: #ff3333;
            --term-yellow: #ffcc00;
            --term-blue: #008cff;
            --button-bg: #eee;
            --button-border: #aaa;
            --button-text: #333;
            --grid-color: #e0e0e0;
            --tooltip-bg: rgba(255, 255, 255, 0.95);
            --tooltip-color: #333;
            --tooltip-border-color: #333;
            --tooltip-arrow-color: #333;
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--main-text-color);
            overflow: hidden;
            display: grid;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            transition: background-color 0.3s;
        }

        header {
            border-bottom: 1px solid var(--ui-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: var(--header-bg);
            z-index: 10;
            transition: background 0.3s, border-color 0.3s;
        }

        .title {
            font-weight: bold;
            color: var(--term-blue);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            transition: color 0.3s;
            user-select: none;
        }

        .light-mode .title {
            text-shadow: none;
            color: var(--term-blue);
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            color: var(--button-text);
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
            letter-spacing: 1px;
            user-select: none;
            position: relative;
        }

        button:hover {
            background: var(--ui-border);
            border-color: var(--main-text-color);
        }

        button.active {
            background: rgba(0, 255, 255, 0.2);
            border-color: var(--term-blue);
            color: var(--term-blue);
        }

        button.danger.active {
            background: rgba(255, 51, 51, 0.2);
            border-color: var(--term-red);
            color: var(--term-red);
        }

        .light-mode button.active {
            background: rgba(0, 0, 204, 0.1);
        }

        .light-mode button.danger.active {
            background: rgba(204, 0, 0, 0.1);
        }

        #vis-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .hud-panel {
            position: absolute;
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid var(--term-blue);
            padding: 10px;
            border-radius: 4px;
            z-index: 5;
            transition: all 0.3s;
            user-select: none;
        }

        .light-mode .hud-panel {
            background: rgba(255, 255, 255, 0.9);
            color: var(--main-text-color);
            border: 1px solid var(--term-blue);
        }

        #server-hud {
            top: 20px;
            right: 20px;
            width: 250px;
        }

        #education-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 320px;
            max-height: calc(100% - 40px);
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--term-blue);
            border-radius: 4px;
            padding: 15px;
            z-index: 6;
            transition: all 0.3s;
            user-select: text;
            overflow-y: auto;
            transform: translateX(-100%);
            opacity: 0;
        }

        #education-panel.show {
            transform: translateX(0);
            opacity: 1;
        }

        .light-mode #education-panel {
            background: rgba(255, 255, 255, 0.98);
        }

        #education-panel::-webkit-scrollbar {
            width: 6px;
        }

        #education-panel::-webkit-scrollbar-track {
            background: var(--ui-border);
            border-radius: 3px;
        }

        #education-panel::-webkit-scrollbar-thumb {
            background: var(--term-blue);
            border-radius: 3px;
        }

        .education-title {
            color: var(--term-blue);
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--ui-border);
        }

        .education-section {
            margin: 12px 0;
        }

        .education-subtitle {
            color: var(--term-blue);
            font-size: 14px;
            font-weight: bold;
            margin: 8px 0 4px;
        }

        .education-text {
            font-size: 13px;
            line-height: 1.5;
            margin: 4px 0;
        }

        .education-note {
            font-size: 12px;
            margin-top: 6px;
            padding-left: 8px;
            border-left: 2px solid var(--term-red);
        }

        .meter-row {
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }

        .meter-track {
            height: 8px;
            background: var(--ui-border);
            width: 100%;
            border: 1px solid var(--ui-border);
        }

        .meter-fill {
            height: 100%;
            width: 0%;
            transition: width 0.1s linear;
        }

        .fill-green {
            background: var(--term-green);
        }

        .fill-red {
            background: var(--term-red);
        }

        .fill-yellow {
            background: var(--term-yellow);
        }

        .annotation {
            position: absolute;
            color: var(--term-yellow);
            font-size: 0.7rem;
            text-shadow: 0 0 5px var(--term-yellow);
            z-index: 10;
        }

        .custom-tooltip {
            position: absolute;
            padding: 6px 10px;
            background: var(--tooltip-bg);
            color: var(--tooltip-color);
            border: 1px solid var(--tooltip-border-color);
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 9999;
            opacity: 0;
            transform: translateX(-50%) translateY(5px) scale(0.95);
            transition:
                opacity 0.25s ease 0s,
                transform 0.25s ease 0s;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
        }

        .custom-tooltip.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0) scale(1);
        }

        .custom-tooltip::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 5px solid transparent;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.25s ease 0s;
            border-bottom-color: var(--tooltip-arrow-color);
            top: -10px;
        }

        .custom-tooltip.show::after {
            opacity: 1;
        }

        .custom-tooltip:not(.show) {
            transition-duration: 0.1s, 0.1s;
            transition-delay: 0s, 0s;
        }

        .custom-tooltip:not(.show)::after {
            transition-duration: 0.15s;
        }

        .education-text a {
            color: var(--term-blue);
        }

        @keyframes server-shake {
            0% {
                transform: translate(1px, 1px);
            }

            25% {
                transform: translate(-1px, -1px);
            }

            50% {
                transform: translate(1px, -1px);
            }

            75% {
                transform: translate(-1px, 1px);
            }

            100% {
                transform: translate(0, 0);
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="title">CyberDefenseVisualizationDemo</div>
        <div class="controls">
            <button onclick="setMode('normal')" class="active" id="btn-normal" data-tooltip="æ­£å¸¸ä¸šåŠ¡æµé‡æ¨¡å¼ï¼Œæ¨¡æ‹Ÿå¸¸è§„ç”¨æˆ·è®¿é—®">æ­£å¸¸ä¸šåŠ¡
                (Safe)</button>
            <button onclick="setMode('ddos')" class="danger" id="btn-ddos" data-tooltip="åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œé€šè¿‡å¤§é‡æµé‡æ·¹æ²¡æœåŠ¡å™¨å¸¦å®½">DDoS
                (æµé‡æ´ªæ³›)</button>
            <button onclick="setMode('cc')" class="danger" id="btn-cc"
                data-tooltip="å¸¸è§„CCæ”»å‡»ï¼ŒHTTP(S)-Floodï¼Œæ¨¡æ‹Ÿå¤§é‡ç”¨æˆ·è¯·æ±‚æ¶ˆè€—æœåŠ¡å™¨CPUèµ„æº">CC-Flood(èµ„æºè€—å°½)</button>
            <button onclick="setMode('bypass')" class="danger" id="btn-bypass"
                data-tooltip="CCæ”»å‡»ç»•è¿‡é˜²æŠ¤ï¼ŒBypassï¼Œä½¿ç”¨ä¼ªè£…æŠ€æœ¯ç»•è¿‡WAFæ£€æµ‹">CC-Bypass(è¯·æ±‚ä¼ªè£…)</button>
            <div style="width:1px; background:#444; margin:0 5px;"></div>
            <button onclick="toggleEducationPanel()" id="btn-education" data-tooltip="æ˜¾ç¤º/éšè—æœ¬é¡µè¯´æ˜ä¸åŸºç¡€æ•™è‚²ç§‘æ™®">è¯´æ˜</button>
            <button onclick="restartServer()" id="btn-restart" class="danger">é‡å¯æœåŠ¡å™¨</button>
            <button onclick="toggleWAF()" id="btn-waf">CDN-WAF: å…³</button>
            <button onclick="toggleTheme()" id="btn-theme">ğŸŒ™åˆ‡æ¢ä¸»é¢˜</button>
        </div>
    </header>

    <div id="vis-container">
        <canvas id="simCanvas"></canvas>

        <div id="education-panel" class="hud-panel">
            <div class="education-title">æœ¬é¡µè¯´æ˜ä¸åŸºç¡€æ•™è‚²ç§‘æ™®</div>

            <div class="education-section">
                <div class="education-subtitle">å… è´£ å£° æ˜</div>
                <div class="education-text">â€¢ æœ¬é¡µæ¨¡æ‹Ÿäº†ä¸€ä¸ªç®€å•çš„ç½‘ç»œæ”»é˜²åœºæ™¯ï¼Œå±•ç¤ºäº†ä¸åŒæ”»å‡»æ–¹å¼å¯¹æœåŠ¡å™¨çš„å½±å“ï¼Œæ‰€æœ‰å†…å®¹å‡ä¸ºæ¨¡æ‹Ÿæ•°æ®</div>
                <div class="education-text">â€¢ é€šè¿‡æ¨¡æ‹Ÿæ­£å¸¸ä¸šåŠ¡æµé‡ã€DDoSæ”»å‡»ã€CCæ”»å‡»ç­‰åœºæ™¯ï¼Œç”¨æˆ·å¯ä»¥ç›´è§‚åœ°ç†è§£ä¸åŒæ”»å‡»æ–¹å¼çš„å±å®³å’Œé˜²æŠ¤æ‰‹æ®µ</div>
                <div class="education-text">â€¢ é¡µé¢ä»…ç”¨äºå­¦ä¹ å’Œæ¼”ç¤ºï¼Œä¸ä»£è¡¨ä»»ä½•å®é™…çš„ç½‘ç»œæ”»é˜²åœºæ™¯</div>
                <div class="education-text">â€¢ ç§‘æ™®å†…å®¹ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œé€‚ç”¨äºåŸºç¡€å­¦ä¹ è€…ï¼Œè¯·å‹¿ä½œä¸ºä¸“ä¸šå»ºè®®è¿›è¡Œå‚è€ƒ</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">é¡µé¢å¿«é€Ÿä¸Šæ‰‹æ“ä½œæŒ‡å¼•</div>
                <div class="education-text">â€¢ ç‚¹å‡»ä¸åŒæ”»å‡»æ¨¡å¼æŒ‰é’®ï¼Œè§‚å¯ŸæœåŠ¡å™¨CPU/å¸¦å®½/è¿æ¥æ•°çš„å˜åŒ–</div>
                <div class="education-text">â€¢ å¼€å¯ã€ŒCDN-WAFã€åï¼Œå¯¹æ¯”æ”»å‡»è¢«æ‹¦æˆªçš„æ•ˆæœï¼ˆä¸åŒæ”»å‡»çš„æ‹¦æˆªç‡ä¸åŒï¼‰</div>
                <div class="education-text">â€¢ æœåŠ¡å™¨å´©æºƒåï¼Œç‚¹å‡»ã€Œé‡å¯æœåŠ¡å™¨ã€å¯é‡ç½®æ‰€æœ‰çŠ¶æ€</div>
                <div class="education-text">â€¢ åˆ‡æ¢ã€Œæµ…è‰²/æ·±è‰²ä¸»é¢˜ã€é€‚é…ä¸åŒè§†è§‰ä¹ æƒ¯</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">äº’åŠ¨æ¼”ç¤ºè¯´æ˜</div>
                <div class="education-text">â€¢ <span style="color:var(--term-green)">ç»¿è‰²</span>å…‰ç‚¹ï¼šæ­£å¸¸ç”¨æˆ·è¯·æ±‚</div>
                <div class="education-text">â€¢ <span style="color:var(--term-red)">çº¢è‰²</span>å…‰ç‚¹ï¼šDDoSæ”»å‡»æ•°æ®åŒ…</div>
                <div class="education-text">â€¢ <span style="color:var(--term-yellow)">é»„è‰²</span>å…‰ç‚¹ï¼šCCæ”»å‡»è¯·æ±‚</div>
                <div class="education-text">â€¢ <span style="color:var(--term-blue)">è“è‰²</span>å±éšœï¼šWAFé˜²æŠ¤å¢™</div>
                <div class="education-text">â€¢ å…‰ç‚¹çˆ†ç‚¸ï¼šè¯·æ±‚è¢«WAFæ‹¦æˆªæˆ–åˆ°è¾¾æœåŠ¡å™¨</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">1. æ­£å¸¸ä¸šåŠ¡æµé‡ (Normal)</div>
                <div class="education-text">â€¢ ç‰¹å¾ï¼šè¯·æ±‚é¢‘ç‡ä½ã€å•è¯·æ±‚èµ„æºæ¶ˆè€—å°ã€æ¥æºåˆ†æ•£ä¸”åˆæ³•</div>
                <div class="education-text">â€¢ å¯¹æœåŠ¡å™¨å½±å“ï¼šCPU/å¸¦å®½/è¿æ¥æ•°ç»´æŒåœ¨ä½æ°´å¹³ï¼ŒæœåŠ¡å™¨å¥åº·åº¦ç¨³å®š</div>
                <div class="education-note">æ³¨ï¼šåˆç†çš„è¯·æ±‚é‡ä¸ä¼šå¯¹æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ›ï¼Œå¿…è¦æ—¶å¯è€ƒè™‘CDNåˆ†å‘ä»¥åŠè´Ÿè½½å‡è¡¡</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">2. DDoSæ”»å‡» (åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡)</div>
                <div class="education-text">â€¢ åŸç†ï¼šåˆ©ç”¨å¤§é‡åƒµå°¸ç½‘ç»œï¼ˆBotnetï¼‰å‘é€æµ·é‡æ•°æ®åŒ…ï¼Œè€—å°½æœåŠ¡å™¨å¸¦å®½</div>
                <div class="education-text">â€¢ ç‰¹å¾ï¼šæµé‡æš´å¢ã€æ•°æ®åŒ…ä½“ç§¯å¤§ã€æ”»å‡»é€Ÿåº¦å¿«ï¼Œå±äºç½‘ç»œå±‚æ”»å‡»</div>
                <div class="education-text">â€¢ å±å®³ï¼šæœåŠ¡å™¨å¸¦å®½è¢«å æ»¡ï¼Œåˆæ³•è¯·æ±‚æ— æ³•åˆ°è¾¾ï¼Œè¡¨ç°ä¸ºæœåŠ¡å™¨å…¬ç½‘æ— æ³•è®¿é—®</div>
                <div class="education-note">é˜²æŠ¤æ‰‹æ®µï¼šCDNæµé‡æ¸…æ´—ã€é»‘æ´è·¯ç”±ã€DDoSé«˜é˜²IP</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">3. å¸¸è§„CCæ”»å‡» (HTTP(s)-Flood)</div>
                <div class="education-text">â€¢ åŸç†ï¼šæ¨¡æ‹Ÿå¤§é‡åˆæ³•ç”¨æˆ·å‘é€HTTPè¯·æ±‚ï¼Œæ¶ˆè€—æœåŠ¡å™¨CPU/å†…å­˜èµ„æº</div>
                <div class="education-text">â€¢ ç‰¹å¾ï¼šè¯·æ±‚æ•°å¤šã€å•è¯·æ±‚è€—CPUï¼ˆå¦‚åŠ¨æ€æ¥å£æˆ–å¤æ‚æŸ¥è¯¢ï¼‰ã€å±äºåº”ç”¨å±‚æ”»å‡»</div>
                <div class="education-text">â€¢ å±å®³ï¼šæœåŠ¡å™¨CPUå ç”¨ç‡é«˜ï¼Œæ— æ³•å¤„ç†æ­£å¸¸è¯·æ±‚ï¼Œå“åº”è¶…æ—¶</div>
                <div class="education-note">é˜²æŠ¤æ‰‹æ®µï¼šè¯·æ±‚é¢‘ç‡é™åˆ¶ã€éªŒè¯ç ã€äººæœºéªŒè¯ã€WAFè§„åˆ™æ‹¦æˆª</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">4. Bypass (ç»•è¿‡é˜²æŠ¤çš„CCæ”»å‡»)</div>
                <div class="education-text">â€¢ åŸç†ï¼šé€šè¿‡ä¼ªè£…è¯·æ±‚ç‰¹å¾æˆ–åˆæ³•è¡Œä¸ºç»•è¿‡WAFæ£€æµ‹ï¼ˆå¦‚ä¼ªé€ åˆæ³•User-Agentã€IPæ¬ºéª—ã€Cookieé‡æ”¾ï¼‰</div>
                <div class="education-text">â€¢ ç‰¹å¾ï¼šæ”»å‡»åŒ…ä¼ªè£…æˆæ­£å¸¸è¯·æ±‚ï¼ŒåˆæœŸéš¾ä»¥è¢«è¯†åˆ«ï¼Œä¼šé€æ­¥æš´éœ²ç‰¹å¾</div>
                <div class="education-text">â€¢ å±å®³ï¼šç»•è¿‡åŸºç¡€é˜²æŠ¤è§„åˆ™ï¼ŒæŒç»­æ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œéšè”½æ€§æ›´å¼º</div>
                <div class="education-note">é˜²æŠ¤æ‰‹æ®µï¼šè¡Œä¸ºåˆ†æã€ç‰¹å¾è¯†åˆ«ã€JSæŒ‘æˆ˜ã€åˆç†çš„WAFé…ç½®</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">5. CDNæä¾›çš„WAFé˜²æŠ¤</div>
                <div class="education-text">â€¢ ä½œç”¨ï¼šéƒ¨ç½²åœ¨CDNç«¯ï¼Œå¯è¿‡æ»¤æ¶æ„è¯·æ±‚ï¼Œä¿æŠ¤Webåº”ç”¨å®‰å…¨</div>
                <div class="education-text">â€¢ é˜²æŠ¤èƒ½åŠ›ï¼šåœ¨åˆç†é…ç½®ä¸‹ï¼Œå¯æ‹¦æˆªå¤§éƒ¨åˆ†çš„DDoS/CCæ”»å‡»</div>
                <div class="education-text">â€¢ ç›¸æ¯”æœ¬åœ°WAFä¼˜åŠ£åŠ¿ï¼šå¤šåœ°è¾¹ç¼˜èŠ‚ç‚¹é˜²æŠ¤ã€ä½å»¶è¿Ÿã€DDoSé˜²æŠ¤èƒ½åŠ›æ›´å¼ºï¼Œä½†é…ç½®çµæ´»æ€§ç¨ä½</div>
                <div class="education-text">â€¢ å¯åœ¨æœ¬é¡µä¸­ç‚¹å‡»"CDN-WAF"æŒ‰é’®ï¼Œç²—ç•¥è§‚å¯Ÿä¸åŒæ”»å‡»çš„æ‹¦æˆªæ•ˆæœå·®å¼‚</div>
                <div class="education-note">æ³¨ï¼šWAFä¸æ˜¯ä¸‡èƒ½çš„ï¼WAFä¸æ˜¯ä¸‡èƒ½çš„ï¼å®é™…åœºæ™¯ä¸­éœ€ç»“åˆå¤šç§é˜²æŠ¤æ‰‹æ®µæ„å»ºå®Œæ•´å®‰å…¨ä½“ç³»ï¼</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">6. æœ¬é¡µçš„æœåŠ¡å™¨çŠ¶æ€æŒ‡æ ‡</div>
                <div class="education-text">â€¢ CPUè´Ÿè½½ï¼šåæ˜ æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„è®¡ç®—å‹åŠ›ï¼ŒCCæ”»å‡»ä¸»è¦å½±å“è¯¥æŒ‡æ ‡</div>
                <div class="education-text">â€¢ å¸¦å®½å ç”¨ï¼šåæ˜ ç½‘ç»œä¼ è¾“å‹åŠ›ï¼ŒDDoSæ”»å‡»ä¸»è¦å½±å“è¯¥æŒ‡æ ‡</div>
                <div class="education-text">â€¢ å¹¶å‘è¿æ¥æ•°ï¼šåŒæ—¶ä¸æœåŠ¡å™¨å»ºç«‹çš„è¿æ¥æ•°é‡ï¼Œè¶…é™ä¼šå¯¼è‡´æ–°è¯·æ±‚æ— æ³•å»ºç«‹</div>
                <div class="education-note">æç¤ºï¼šæœåŠ¡å™¨çŠ¶æ€æŒ‡æ ‡ä»…ä¾›å‚è€ƒï¼Œå®é™…æƒ…å†µè¦å¤æ‚çš„å¤šï¼ˆå¦‚å†…å­˜ã€ç£ç›˜IOã€æ•°æ®åº“å‹åŠ›ç­‰ï¼‰</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">7. è¡¥å……è®¤çŸ¥ï¼šæ”»å‡»ä¸é˜²æŠ¤çš„æ ¸å¿ƒé€»è¾‘</div>
                <div class="education-text">â€¢ æ”»å‡»æœ¬è´¨ï¼šæ¶ˆè€—ç›®æ ‡çš„æœ‰é™èµ„æºï¼ˆå¸¦å®½/CPU/è¿æ¥æ•°ï¼‰ï¼Œä½¿å…¶æ— æ³•æä¾›æ­£å¸¸æœåŠ¡</div>
                <div class="education-text">â€¢ é˜²æŠ¤æ ¸å¿ƒï¼šè¯†åˆ«æ¶æ„æµé‡ï¼ˆç‰¹å¾/è¡Œä¸º+éš”ç¦»/æ‹¦æˆª+æ‰©å®¹æŠ—æ”»å‡»èµ„æº</div>
                <div class="education-text">â€¢ æœ¬é¡µæ¼”ç¤ºå±€é™æ€§ï¼šæœªæ¨¡æ‹Ÿæ··åˆæ”»å‡»ã€å¤šå±‚é˜²æŠ¤ã€å¼¹æ€§æ‰©å®¹ç­‰çœŸå®åœºæ™¯ï¼›æœªæ¨¡æ‹ŸWebåº”ç”¨å±‚æ”»å‡»ï¼ˆå¦‚SQLæ³¨å…¥ã€XSSç­‰ï¼‰</div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">8. åŸºç¡€ç½‘ç»œåˆ†å±‚è®¤çŸ¥</div>
                <div class="education-text">â€¢ åº”ç”¨å±‚ï¼ˆL7ï¼‰ï¼šå¤„ç†HTTP/HTTPSç­‰åè®®ï¼Œè´Ÿè´£ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®äº¤æ¢</div>
                <div class="education-text">â€¢ ä¼ è¾“å±‚ï¼ˆL4ï¼‰ï¼Œè´Ÿè´£ç«¯åˆ°ç«¯çš„é€šä¿¡ï¼Œå¦‚TCP/UDP</div>
                <div class="education-text">â€¢ å‚è€ƒæ–‡ç« ï¼š<a href="https://www.rockaz.top/blog/post_detail?id=21"
                        target="_blank">å…³äºOSIä¸ƒå±‚æ¨¡å‹ï¼šé™¤äº†L4å’ŒL7ï¼Œå…¶ä»–å±‚éƒ½å»å“ªäº†ï¼Ÿ</a></div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">9. å‚è€ƒæ–‡çŒ® / å»ºè®®é˜…è¯»</div>
                <div class="education-text">â€¢ Cloudflareå­¦ä¹ ä¸­å¿ƒï¼š<a
                        href="https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack/"
                        target="_blank">ä»€ä¹ˆæ˜¯DDoSæ”»å‡»ï¼Ÿ</a></div>
                <div class="education-text">â€¢ Cloudflareå­¦ä¹ ä¸­å¿ƒï¼š<a
                        href="https://www.cloudflare.com/learning/ddos/ip-spoofing/" target="_blank">ä»€ä¹ˆæ˜¯IPæ¬ºéª—ï¼Ÿ</a></div>
                <div class="education-text">â€¢ Cloudflareå­¦ä¹ ä¸­å¿ƒï¼š<a
                        href="https://www.cloudflare-cn.com/learning/ddos/how-to-prevent-ddos-attacks/"
                        target="_blank">å¦‚ä½•é¢„é˜²DDoSæ”»å‡»ï¼Ÿ</a></div>
                <div class="education-text">â€¢ Cloudflareå­¦ä¹ ä¸­å¿ƒï¼š<a
                        href="https://www.cloudflare-cn.com/learning/cdn/what-is-a-cdn/"
                        target="_blank">ä»€ä¹ˆæ˜¯å†…å®¹åˆ†å‘ç½‘ç»œ(CDN)ï¼Ÿ</a></div>
                <div class="education-text">â€¢ Cloudflareå­¦ä¹ ä¸­å¿ƒï¼š<a
                        href="https://www.cloudflare-cn.com/learning/security/what-is-web-application-security/"
                        target="_blank">ä»€ä¹ˆæ˜¯Webåº”ç”¨å®‰å…¨ï¼Ÿ</a></div>
                <div class="education-text">â€¢ è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒºï¼š<a href="https://cloud.tencent.com/developer/article/2452860"
                        target="_blank">CCæ”»å‡»ï¼Œä¸€ç§ç‰¹æ®Šçš„DDoSæ”»å‡»</a></div>
                <div class="education-text">â€¢ é˜¿é‡Œäº‘æ–‡æ¡£ï¼š<a
                        href="https://help.aliyun.com/zh/waf/web-application-firewall-3-0/use-cases/cc-attack-protection-best-practices"
                        target="_blank">CCæ”»å‡»é˜²æŠ¤æœ€ä½³å®è·µ</a></div>
                <div class="education-text">â€¢ CSDNåšå®¢ï¼š<a
                        href="https://blog.csdn.net/m0_51330619/article/details/120422150"
                        target="_blank">CCæ”»å‡»â€”â€”æš´åŠ›ç ´è§£/æ‰«æç›®å½•ç»•è¿‡å®‰å…¨ç‹—WAF</a></div>
            </div>

            <div class="education-section">
                <div class="education-subtitle">10. ç®€å•çš„æµ‹éªŒ</div>
                <div class="education-text" style="margin-bottom: 12px;">é€šè¿‡ä»¥ä¸‹é¢˜ç›®æ£€éªŒåŸºç¡€è®¤çŸ¥ï¼ˆæ¯é¢˜å‡ä¸ºå•é€‰ï¼‰ï¼š</div>

                <div style="margin: 10px 0; padding: 10px; border: 1px solid var(--ui-border); border-radius: 4px;">
                    <div style="margin-bottom: 8px; font-size: 13px; font-weight: 500;">1. ä»¥ä¸‹å…³äºDDoSå’ŒCCæ”»å‡»çš„æ ¸å¿ƒåŒºåˆ«ï¼Œæè¿°æœ€å‡†ç¡®çš„æ˜¯ï¼Ÿ
                    </div>
                    <div>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q1" value="a" onclick="checkAnswer('q1', this)"> A.
                            DDoSåªæ”»å‡»å¸¦å®½ï¼ŒCCåªæ”»å‡»CPU
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q1" value="b" onclick="checkAnswer('q1', this)"> B.
                            DDoSä¾§é‡ç½‘ç»œå±‚èµ„æºè€—å°½ï¼ŒCCä¾§é‡åº”ç”¨å±‚èµ„æºæ¶ˆè€—
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q1" value="c" onclick="checkAnswer('q1', this)"> C.
                            DDoSæ˜¯æ‰‹åŠ¨æ”»å‡»ï¼ŒCCæ˜¯è‡ªåŠ¨åŒ–æ”»å‡»
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q1" value="d" onclick="checkAnswer('q1', this)"> D.
                            DDoSå¯ä»¥è¢«WAFæ‹¦æˆªï¼ŒCCæ— æ³•æ‹¦æˆª
                        </label>
                    </div>
                    <div id="q1-result" style="margin-top: 6px; font-size: 12px;"></div>
                </div>

                <div style="margin: 10px 0; padding: 10px; border: 1px solid var(--ui-border); border-radius: 4px;">
                    <div style="margin-bottom: 8px; font-size: 13px; font-weight: 500;">2. CC-Bypassï¼ˆç»•è¿‡é˜²æŠ¤çš„CCæ”»å‡»ï¼‰çš„æ ¸å¿ƒç‰¹å¾æ˜¯ï¼Ÿ
                    </div>
                    <div>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q2" value="a" onclick="checkAnswer('q2', this)"> A. æ”»å‡»æµé‡è¿œå¤§äºæ™®é€šCCæ”»å‡»
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q2" value="b" onclick="checkAnswer('q2', this)"> B.
                            ä¼ªè£…è¯·æ±‚ç‰¹å¾ï¼Œè§„é¿WAFåŸºç¡€è§„åˆ™æ£€æµ‹
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q2" value="c" onclick="checkAnswer('q2', this)"> C.
                            ç›´æ¥æ”»å‡»æœåŠ¡å™¨ç¡¬ä»¶ï¼Œè€Œéç½‘ç»œå±‚é¢
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q2" value="d" onclick="checkAnswer('q2', this)"> D. åªèƒ½åœ¨å…³é—­WAFæ—¶ç”Ÿæ•ˆ
                        </label>
                    </div>
                    <div id="q2-result" style="margin-top: 6px; font-size: 12px;"></div>
                </div>

                <div style="margin: 10px 0; padding: 10px; border: 1px solid var(--ui-border); border-radius: 4px;">
                    <div style="margin-bottom: 8px; font-size: 13px; font-weight: 500;">3. ä»¥ä¸‹å“ªç§é˜²æŠ¤æ‰‹æ®µå¯¹DDoSæ”»å‡»çš„é˜²å¾¡æ•ˆæœæœ€ä¼˜ï¼Ÿ</div>
                    <div>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q3" value="a" onclick="checkAnswer('q3', this)"> A. å¢åŠ æœåŠ¡å™¨CPUæ ¸å¿ƒæ•°
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q3" value="b" onclick="checkAnswer('q3', this)"> B. éƒ¨ç½²CDNæµé‡æ¸…æ´—+é«˜é˜²IP
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q3" value="c" onclick="checkAnswer('q3', this)"> C. å…³é—­æœåŠ¡å™¨ä¸å¿…è¦çš„ç«¯å£
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q3" value="d" onclick="checkAnswer('q3', this)"> D. ä»…ä¾èµ–åº”ç”¨å±‚WAFè§„åˆ™
                        </label>
                    </div>
                    <div id="q3-result" style="margin-top: 6px; font-size: 12px;"></div>
                </div>

                <div style="margin: 10px 0; padding: 10px; border: 1px solid var(--ui-border); border-radius: 4px;">
                    <div style="margin-bottom: 8px; font-size: 13px; font-weight: 500;">4.
                        æœåŠ¡å™¨CPUæŒç»­90%ä»¥ä¸Šé«˜è´Ÿè½½ä¸”é•¿æ—¶é—´æ— æ³•ç¼“è§£ï¼Œæœ€å¯èƒ½æ˜¯å“ªç§æ”»å‡»å¯¼è‡´ï¼Ÿ</div>
                    <div>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q4" value="a" onclick="checkAnswer('q4', this)"> A. å¤§æµé‡DDoSæ”»å‡»
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q4" value="b" onclick="checkAnswer('q4', this)"> B. CC/CC-Bypassæ”»å‡»
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q4" value="c" onclick="checkAnswer('q4', this)"> C. æ•°æ®åº“æ³¨å…¥æ”»å‡»
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q4" value="d" onclick="checkAnswer('q4', this)"> D. ç«¯å£æ‰«ææ”»å‡»
                        </label>
                    </div>
                    <div id="q4-result" style="margin-top: 6px; font-size: 12px;"></div>
                </div>

                <div style="margin: 10px 0; padding: 10px; border: 1px solid var(--ui-border); border-radius: 4px;">
                    <div style="margin-bottom: 8px; font-size: 13px; font-weight: 500;">5. å…³äºCDNçš„WAFé˜²æŠ¤é€»è¾‘ï¼Œä»¥ä¸‹è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ
                    </div>
                    <div>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q5" value="a" onclick="checkAnswer('q5', this)"> A.
                            WAFå¯åœ¨CDNè¾¹ç¼˜èŠ‚ç‚¹æå‰è¿‡æ»¤æ¶æ„è¯·æ±‚
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q5" value="b" onclick="checkAnswer('q5', this)"> B.
                            CDNå¯åˆ†æ•£æºç«™å‹åŠ›ï¼Œé™ä½DDoS/CCæ”»å‡»å½±å“
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q5" value="c" onclick="checkAnswer('q5', this)"> C.
                            å¼€å¯WAFåèƒ½100%æ‹¦æˆªæ‰€æœ‰CC-Bypassæ”»å‡»
                        </label>
                        <label style="display: block; margin: 5px 0; cursor: pointer; font-size: 12px;">
                            <input type="radio" name="q5" value="d" onclick="checkAnswer('q5', this)"> D.
                            WAFå¯¹ç½‘ç»œå±‚å’Œåº”ç”¨å±‚æ”»å‡»çš„é˜²æŠ¤èƒ½åŠ›ä¸åŒ
                        </label>
                    </div>
                    <div id="q5-result" style="margin-top: 6px; font-size: 12px;"></div>
                </div>

                <div style="margin-top: 15px; padding: 10px; border-top: 1px solid var(--term-blue);">
                    <button onclick="calculateScore()" style="padding: 6px 12px; font-size: 12px;">è®¡ç®—æ€»åˆ†ğŸ¤“</button>
                    <div id="score-result" style="margin-top: 8px; font-size: 13px; color: var(--term-yellow);"></div>
                </div>
            </div>

        </div>

        <div id="server-hud" class="hud-panel">
            <div
                style="border-bottom:1px solid var(--term-blue); margin-bottom:10px; padding-bottom:5px; color:var(--term-blue);">
                æœåŠ¡å™¨çŠ¶æ€é¢æ¿</div>

            <div class="meter-row"
                style="border-bottom:1.7px dashed var(--ui-border); padding-bottom:5px; margin-bottom:5px;">
                <div class="meter-label">
                    <span>Requests / è¯·æ±‚æ•°</span>
                    <span id="txt-total-req" style="color:var(--term-blue); font-weight:bold;">0</span>
                </div>
                <div class="meter-label">
                    <span>Traffic / æµé‡</span>
                    <span id="txt-total-vol" style="color:var(--term-red); font-weight:bold;">0 GB</span>
                </div>
            </div>

            <div class="meter-row">
                <div class="meter-label"><span>CPU / å¤„ç†è´Ÿè½½</span><span id="txt-cpu">0%</span></div>
                <div class="meter-track">
                    <div class="meter-fill fill-yellow" id="bar-cpu"></div>
                </div>
            </div>

            <div class="meter-row">
                <div class="meter-label"><span>Bandwidth / å¸¦å®½</span><span id="txt-bw">0%</span></div>
                <div class="meter-track">
                    <div class="meter-fill fill-red" id="bar-bw"></div>
                </div>
            </div>

            <div class="meter-row">
                <div class="meter-label"><span>Active Connections / å¹¶å‘è¿æ¥æ•°</span><span id="txt-conn">0</span></div>
                <div class="meter-track">
                    <div class="meter-fill fill-green" id="bar-conn"></div>
                </div>
            </div>

            <div id="server-alert"
                style="margin-top:15px; color: var(--term-red); font-weight:bold; display:none; text-align:center; border:1px solid var(--term-red); padding:5px;">
                â›”æœåŠ¡å™¨å±æ€¥/åœæœº</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const SERVER_SIZE = 60;
        const root = document.documentElement;
        const body = document.body;

        let width, height;
        let particles = [];
        let explosions = [];
        let annotations = [];
        let processingTasks = [];
        let mode = 'normal';
        let wafEnabled = false;
        let frameCount = 0;
        let isLightMode = false;
        let educationPanelVisible = false;

        let stats = {
            cpu: 0,
            bandwidth: 0,
            connections: 0,
            health: 100,
            totalReq: 0,
            totalVol: 0
        };

        let highCpuDuration = 0;
        const HIGH_CPU_THRESHOLD = 90;
        const CPU_CRASH_DURATION = 250;

        let attackerX, serverX, centerY;
        let wallX;

        function resize() {
            width = window.innerWidth;
            height = document.getElementById('vis-container').clientHeight;
            canvas.width = width;
            canvas.height = height;

            attackerX = width * 0.1;
            serverX = width * 0.85;
            wallX = width * 0.5;
            centerY = height / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        function detectMobileDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isSmallScreen = window.innerWidth < 768;
            if (isMobile || isSmallScreen) {
                alert("è¯·å¼€å¯æµè§ˆå™¨çš„'ç”µè„‘ç‰ˆè®¿é—®'åŠŸèƒ½ä»¥è·å¾—æœ€ä½³ä½“éªŒï¼");
            }
        }

        detectMobileDevice();

        function toggleEducationPanel() {
            educationPanelVisible = !educationPanelVisible;
            const panel = document.getElementById('education-panel');
            const btn = document.getElementById('btn-education');

            if (educationPanelVisible) {
                panel.classList.add('show');
                btn.classList.add('active');
            } else {
                panel.classList.remove('show');
                btn.classList.remove('active');
            }
        }

        (function () {
            const tooltip = document.createElement('div');
            tooltip.className = 'custom-tooltip top';
            document.body.appendChild(tooltip);

            const tooltipButtons = document.querySelectorAll('button[data-tooltip]');
            let hideTimer = null;
            let showTimer = null;
            let currentBtn = null;
            let hasShown = false;
            const SHOW_DELAY = 200;

            tooltipButtons.forEach(button => {
                button.addEventListener('mouseenter', function (e) {
                    clearTimeout(hideTimer);
                    currentBtn = this;

                    if (hasShown) {
                        clearTimeout(showTimer);
                        if (tooltip.classList.contains('show')) {
                            tooltip.classList.remove('show');
                            setTimeout(() => showTooltip(this), 50);
                        } else {
                            showTooltip(this);
                        }
                    } else {
                        clearTimeout(showTimer);
                        showTimer = setTimeout(() => {
                            if (currentBtn === this) {
                                showTooltip(this);
                                hasShown = true;
                            }
                        }, SHOW_DELAY);
                    }
                });

                button.addEventListener('mouseleave', function () {
                    hideTimer = setTimeout(() => {
                        tooltip.classList.remove('show');
                        currentBtn = null;
                        hasShown = false;
                    }, 20);
                });
            });

            window.addEventListener('resize', function () {
                clearTimeout(hideTimer);
                clearTimeout(showTimer);
                tooltip.classList.remove('show');
                currentBtn = null;
                hasShown = false;
            });

            function showTooltip(btn) {
                const text = btn.getAttribute('data-tooltip');
                const rect = btn.getBoundingClientRect();
                tooltip.textContent = text;
                tooltip.style.left = `${rect.left + rect.width / 2}px`;
                tooltip.style.top = `${rect.bottom + 10}px`;
                setTimeout(() => {
                    tooltip.classList.add('show');
                }, 50);
            }
        })();

        function toggleTheme(manual = true) {
            isLightMode = !isLightMode;
            const btn = document.getElementById('btn-theme');
            if (isLightMode) {
                body.classList.add('light-mode');
                btn.innerHTML = 'â˜€ï¸ åˆ‡æ¢ä¸»é¢˜';
            } else {
                body.classList.remove('light-mode');
                btn.innerHTML = 'ğŸŒ™ åˆ‡æ¢ä¸»é¢˜';
            }
            if (manual) {
                localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
            }
        }

        function initTheme() {
            const storedTheme = localStorage.getItem('theme');
            const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;

            if (storedTheme === 'light' || (!storedTheme && prefersLight)) {
                isLightMode = false;
                toggleTheme(false);
            }
        }
        initTheme();

        class Packet {
            constructor(type) {
                this.type = type;
                this.x = attackerX + (Math.random() * 50 - 25);
                this.y = centerY + (Math.random() * 400 - 200);

                this.targetX = serverX;
                this.targetY = centerY + (Math.random() * 100 - 50);

                const angle = Math.atan2(this.targetY - this.y, this.targetX - this.x);

                let speed = 3;
                if (type === 'ddos') speed = 12;
                if (type === 'cc') speed = 7;

                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;

                this.blocked = false;
                this.dead = false;
                this.size = type === 'ddos' ? 1.5 : 3;

                this.color = '';
                this.renderColor = '';
                if (type === 'normal') this.color = this.renderColor = getCSSVar('--term-green');
                if (type === 'ddos') this.color = this.renderColor = getCSSVar('--term-red');
                if (type === 'cc') {
                    this.color = this.renderColor = getCSSVar('--term-yellow');
                }
                if (type === 'bypass') this.color = getCSSVar('--term-yellow');
                if (type === 'bypass') this.renderColor = getCSSVar('--term-green');

                this.volume = 0;
                if (type === 'normal') this.volume = 0.004;
                else if (type === 'ddos') this.volume = 0.3;
                else if (type === 'cc' || type === 'bypass') this.volume = 0.01;
            }

            update() {
                if (wafEnabled && !this.blocked && Math.abs(this.x - wallX) < 10) {
                    let blocked = false;

                    if (this.type === 'ddos') blocked = true;
                    if (this.type === 'cc') {
                        if (Math.random() > 0.3) blocked = true;
                    }

                    if (this.type === 'bypass') {
                        if (Math.random() > 0.95) blocked = true;
                        else {
                            this.renderColor = this.color;
                            annotations.push({
                                x: this.x, y: this.y,
                                text: Math.random() > 0.5 ? '[Fake User-Agent]' : '[IP Spoofing]',
                                life: 40
                            });
                        }
                    }

                    if (blocked) {
                        stats.totalReq++;
                        stats.totalVol += this.volume;

                        this.blocked = true;
                        this.vx = -this.vx * 0.5;
                        this.vy = -this.vy * 0.5;
                        this.dead = true;
                        spawnExplosion(this.x, this.y, this.renderColor, true);
                        return;
                    }
                }

                this.x += this.vx;
                this.y += this.vy;

                if (Math.abs(this.x - serverX) < SERVER_SIZE / 2 && Math.abs(this.y - centerY) < SERVER_SIZE && !this.dead) {
                    this.dead = true;
                    if (stats.health > 0) {
                        stats.totalReq++;
                        stats.totalVol += this.volume;
                        hitServer(this.type);
                    }
                    if (!this.blocked) spawnExplosion(this.x, this.y, this.color, false);
                }

                if (this.x > width || this.x < 0) this.dead = true;
            }

            draw() {
                ctx.fillStyle = this.renderColor;
                ctx.shadowBlur = 5;
                ctx.shadowColor = this.renderColor;

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();

                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x - this.vx * 3, this.y - this.vy * 3);
                ctx.strokeStyle = this.renderColor;
                ctx.stroke();

                ctx.shadowBlur = 0;
                ctx.globalAlpha = 1.0;
            }
        }

        function hitServer(type) {
            if (type === 'normal') {
                stats.bandwidth += 0.5;
                stats.cpu += 0.5;
                stats.connections += 1;
                stats.health = Math.min(100, stats.health + 0.5);
            } else if (type === 'ddos') {
                stats.bandwidth += 12.0;
                stats.connections += 8;
                stats.health = Math.max(0, stats.health - 0.7);
            } else if (type === 'cc' || type === 'bypass') {
                stats.bandwidth += 1.5;
                processingTasks.push({ life: 100 });
                stats.connections += 3;

                stats.health = Math.max(0, stats.health - 0.2);
            }
        }

        function spawnExplosion(x, y, color, isBlocked) {
            for (let i = 0; i < (isBlocked ? 10 : 5); i++) {
                explosions.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    life: 1.0,
                    color: color
                });
            }
        }

        function loop() {
            ctx.fillStyle = getCSSVar('--bg-color');
            ctx.globalAlpha = isLightMode ? 0.8 : 0.4;
            ctx.fillRect(0, 0, width, height);
            ctx.globalAlpha = 1.0;

            drawBackgroundGrid();

            drawNetworkLines();
            drawEntities();

            spawnPackets();

            particles.forEach(p => { p.update(); p.draw(); });
            particles = particles.filter(p => !p.dead);

            updateExplosions();
            updateAnnotations();
            updateServerState();

            requestAnimationFrame(loop);
            frameCount++;
        }

        function getCSSVar(varName) {
            return getComputedStyle(body).getPropertyValue(varName).trim();
        }

        function drawBackgroundGrid() {
            ctx.strokeStyle = getCSSVar('--grid-color');
            ctx.lineWidth = 0.5;
            for (let x = 0; x < width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            for (let y = 0; y < height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
        }

        function drawEntities() {
            ctx.fillStyle = getCSSVar('--term-red');
            if (mode === 'normal') ctx.fillStyle = getCSSVar('--ui-border');

            for (let i = 0; i < 5; i++) {
                let y = centerY + (i - 2) * 60;
                ctx.fillRect(attackerX - 20, y - 10, 20, 20);
                if (mode !== 'normal' && Math.random() > 0.5) {
                    ctx.fillStyle = isLightMode ? '#000' : '#fff';
                    ctx.fillRect(attackerX - 18, y - 8, 4, 4);
                    ctx.fillStyle = getCSSVar('--term-red');
                }
            }
            ctx.font = "14px 'Segoe UI', Arial, sans-serif";
            ctx.fillStyle = getCSSVar('--main-text-color');
            ctx.fillText("Internet / Attackers", attackerX - 50, centerY - 180);

            const loadColor = stats.cpu > 80 ? getCSSVar('--term-red') : getCSSVar('--term-green');
            ctx.fillStyle = isLightMode ? '#ccc' : '#222';
            ctx.strokeStyle = loadColor;
            ctx.lineWidth = 2;
            ctx.fillRect(serverX - 30, centerY - 60, 60, 120);
            ctx.strokeRect(serverX - 30, centerY - 60, 60, 120);

            let tasksHeight = Math.min(100, processingTasks.length * 2);
            ctx.fillStyle = 'rgba(255, 204, 0, 0.6)';
            ctx.fillRect(serverX - 28, centerY + 58 - tasksHeight, 56, tasksHeight);

            ctx.fillStyle = getCSSVar('--main-text-color');
            ctx.fillText("Web Server", serverX - 34, centerY - 70);
        }

        function updateAnnotations() {
            annotations = annotations.filter(a => {
                a.life--;
                return a.life > 0;
            });

            annotations.forEach(a => {
                ctx.fillStyle = a.color || getCSSVar('--term-yellow');
                ctx.globalAlpha = a.life / 40;
                ctx.font = "10px 'Segoe UI', Arial, sans-serif";
                ctx.fillText(a.text, a.x, a.y);
                ctx.globalAlpha = 1.0;
            });
        }

        function drawNetworkLines() {
            ctx.strokeStyle = getCSSVar('--ui-border');
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = -2; i <= 2; i++) {
                let yOffset = i * 50;
                ctx.moveTo(attackerX, centerY + yOffset);
                ctx.lineTo(serverX, centerY + yOffset / 2);
            }
            ctx.stroke();

            if (wafEnabled) {
                ctx.strokeStyle = getCSSVar('--term-blue');
                ctx.lineWidth = 3;
                ctx.shadowBlur = 15;
                ctx.shadowColor = getCSSVar('--term-blue');
                ctx.beginPath();
                ctx.moveTo(wallX, centerY - 200);
                ctx.lineTo(wallX, centerY + 200);
                ctx.stroke();

                let scanY = centerY - 200 + (frameCount * 3 % 390);
                ctx.fillStyle = 'rgba(0, 204, 255, 0.5)';
                ctx.fillRect(wallX - 2, scanY, 4, 20);

                ctx.shadowBlur = 0;

                ctx.fillStyle = getCSSVar('--term-blue');
                ctx.font = "12px 'Segoe UI', Arial, sans-serif";
                ctx.fillText("WAFå·²å¯ç”¨", wallX - 25, centerY - 210);
            } else {
                ctx.strokeStyle = getCSSVar('--ui-border');
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(wallX, centerY - 200);
                ctx.lineTo(wallX, centerY + 200);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        function spawnPackets() {
            let rate = 0.02;
            if (mode === 'ddos') rate = 0.8;
            if (mode === 'cc') rate = 0.4;
            if (mode === 'bypass') rate = 0.4;

            if (Math.random() < 0.02) particles.push(new Packet('normal'));

            if (mode !== 'normal') {
                let count = 1;
                if (mode === 'ddos') count = 5;

                for (let i = 0; i < count; i++) {
                    if (Math.random() < rate) particles.push(new Packet(mode));
                }
            }
        }

        function updateExplosions() {
            explosions.forEach(e => {
                e.x += e.vx;
                e.y += e.vy;
                e.life -= 0.05;

                ctx.globalAlpha = e.life;
                ctx.fillStyle = e.color;
                ctx.beginPath();
                ctx.arc(e.x, e.y, 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            });
            explosions = explosions.filter(e => e.life > 0);
        }

        function updateServerState() {
            let processingPower = 2;
            processingTasks = processingTasks.filter(t => {
                t.life -= 1;
                return t.life > 0;
            });

            let targetCpu = processingTasks.length * 3;
            stats.cpu += (Math.max(2, targetCpu) - stats.cpu) * 0.1;

            stats.bandwidth *= 0.93;
            stats.connections = Math.max(0, Math.min(300, stats.connections * 0.97));

            let cpuVal = Math.min(100, Math.round(stats.cpu));
            if (cpuVal >= HIGH_CPU_THRESHOLD) {
                highCpuDuration++;
                if (highCpuDuration >= CPU_CRASH_DURATION) {
                    stats.health = Math.max(0, stats.health - 2);
                }
            } else {
                highCpuDuration = 0;
            }

            updateHUD();
        }

        function formatVolume(gb) {
            if (gb > 1024 * 1024) return (gb / (1024 * 1024)).toFixed(2) + " PB";
            if (gb > 1024) return (gb / 1024).toFixed(2) + " TB";
            return gb.toFixed(1) + " GB";
        }

        function updateHUD() {
            let cpuVal = Math.min(100, Math.round(stats.cpu));
            let bwVal = Math.min(100, Math.round(stats.bandwidth));
            let connVal = Math.round(stats.connections);

            document.getElementById('txt-cpu').innerText = cpuVal + "%";
            document.getElementById('bar-cpu').style.width = cpuVal + "%";

            document.getElementById('txt-bw').innerText = bwVal + "%";
            document.getElementById('bar-bw').style.width = bwVal + "%";

            document.getElementById('txt-conn').innerText = connVal;
            document.getElementById('bar-conn').style.width = (connVal / 300 * 100) + "%";

            document.getElementById('txt-total-req').innerText = stats.totalReq.toLocaleString();
            document.getElementById('txt-total-vol').innerText = formatVolume(stats.totalVol);

            const alertBox = document.getElementById('server-alert');
            if (stats.health <= 0) {
                alertBox.style.display = 'block';
                if (bwVal >= 95) alertBox.innerText = "â›”æœåŠ¡å™¨å´©æºƒï¼ˆå¸¦å®½è€—å°½ï¼‰";
                else if (cpuVal >= 95 && highCpuDuration >= CPU_CRASH_DURATION) alertBox.innerText = "â›”æœåŠ¡å™¨å´©æºƒï¼ˆCPU æŒç»­è¿‡è½½ï¼‰";
                else if (connVal >= 180) alertBox.innerText = "â›”æœåŠ¡å™¨å´©æºƒï¼ˆè¿æ¥æ•°å æ»¡ï¼‰";
                else alertBox.innerText = "â›”æœåŠ¡å™¨å´©æºƒï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰";
            } else if (cpuVal > 90 || bwVal > 90) {
                alertBox.style.display = 'block';
                alertBox.innerText = cpuVal > 90 ? "âš ï¸CPU è¿‡è½½ï¼ˆåº”ç”¨å±‚å‹åŠ›ï¼‰" : "âš ï¸å¸¦å®½é¥±å’Œï¼ˆç½‘ç»œå±‚å‹åŠ›ï¼‰";
            } else {
                alertBox.style.display = 'none';
            }
        }

        function setMode(m) {
            mode = m;
            document.querySelectorAll('.controls button').forEach(b => {
                if (b.id !== 'btn-waf' && b.id !== 'btn-theme' && b.id !== 'btn-restart' && b.id !== 'btn-education') b.classList.remove('active');
            });
            if (m !== 'waf') document.getElementById('btn-' + m).classList.add('active');
        }

        function toggleWAF() {
            wafEnabled = !wafEnabled;
            const btn = document.getElementById('btn-waf');
            btn.innerText = wafEnabled ? "CDN-WAF: å¼€" : "CDN-WAF: å…³";
            btn.classList.toggle('active');
        }

        function restartServer() {
            stats.health = 200;
            stats.cpu = 5;
            stats.bandwidth = 2;
            stats.connections = 0;
            stats.totalReq = 0;
            stats.totalVol = 0;
            processingTasks = [];
            highCpuDuration = 0;
        }

        function checkAnswer(questionId, radioEl) {
            const correctAnswers = {
                q1: 'b',
                q2: 'b',
                q3: 'b',
                q4: 'b',
                q5: 'c'
            };
            const resultEl = document.getElementById(questionId + '-result');

            if (radioEl.value === correctAnswers[questionId]) {
                resultEl.style.color = getCSSVar('--term-green');
                resultEl.innerText = 'å›ç­”æ­£ç¡®ï¼';
            } else {
                resultEl.style.color = getCSSVar('--term-red');
                resultEl.innerText = 'å›ç­”é”™è¯¯ï¼å†æƒ³æƒ³ï¼Ÿ';
            }
        }

        function getAnswerLabel(answerVal) {
            const labelMap = { a: 'A', b: 'B', c: 'C', d: 'D' };
            return labelMap[answerVal] || '';
        }

        function calculateScore() {
            const correctAnswers = { q1: 'b', q2: 'b', q3: 'b', q4: 'b', q5: 'c' };
            let correctCount = 0;
            let totalCount = Object.keys(correctAnswers).length;

            Object.keys(correctAnswers).forEach(qId => {
                const selectedOption = document.querySelector(`input[name="${qId}"]:checked`);
                if (selectedOption && selectedOption.value === correctAnswers[qId]) {
                    correctCount++;
                }
            });

            const score = (correctCount / totalCount) * 100;
            const scoreEl = document.getElementById('score-result');

            if (score === 100) {
                scoreEl.innerHTML = `æ»¡åˆ†ï¼ï¼ˆ${correctCount}/${totalCount}ï¼‰`;
            } else if (score >= 80) {
                scoreEl.innerHTML = `ä¼˜ç§€ï¼å¾—åˆ†ï¼š${score}åˆ†ï¼ˆ${correctCount}/${totalCount}ï¼‰`;
            } else if (score >= 60) {
                scoreEl.innerHTML = `åˆæ ¼ï¼å¾—åˆ†ï¼š${score}åˆ†ï¼ˆ${correctCount}/${totalCount}ï¼‰ï¼Œå¯å†å·©å›ºä¸‹çŸ¥è¯†ç‚¹`;
            } else {
                scoreEl.innerHTML = `éœ€åŠ å¼ºå­¦ä¹ ï¼å¾—åˆ†ï¼š${score}åˆ†ï¼ˆ${correctCount}/${totalCount}ï¼‰`;
            }
        }

        loop();
    </script>
</body>

</html>